<!DOCTYPE html>
<html>
<head>

	<meta http-equiv="Content-Type" content="text/html" charset=UTF-8">
	<title>Export Timetable</title>
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/demo/demo.css">
	<link rel="stylesheet" href="menuStyle.css" />
	<link rel="stylesheet" href="formcss.css"/>
	<script type="text/javascript "src="updateTimetable.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
	<script type="text/javascript" src="http://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>


	<!-- Firebase Initialize-->
		<script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>
		<script>
			// Initialize Firebase
			var config = {
				apiKey: "AIzaSyCIdVSIBZrq_lSR-HbmFv7E07NiAqzvRfg",
				authDomain: "dynamic-timetable-7ec4d.firebaseapp.com",
				databaseURL: "https://dynamic-timetable-7ec4d.firebaseio.com",
				projectId: "dynamic-timetable-7ec4d",
				storageBucket: "dynamic-timetable-7ec4d.appspot.com",
				messagingSenderId: "958961739233"
			};
			firebase.initializeApp(config);
		</script>
			<script src="index.js"></script>
	<!-- Firebase Initialization over-->

	<style>
    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #333;
    }

    li {
      float: left;
    }

    li a {
      display: block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
    }

    li a:hover:not(.active) {
      background-color: #111;
    }

    .active {
      background-color: #4CAF50;
    }

    .menu{
      display : block;
    }
</style>

	<script type="text/javascript">

	function initalTimetable(){

	//	alert("loading....");

		//var year = localStorage.getItem('year');
   //var year = 2019;
	 var year = document.getElementById("year").value;

		//alert(year);
		var semester = document.getElementById('semester').value;
		for (var i = 1; i < 7; i++) {
			for (var j = 1; j < 9; j++) {
				/* Monday Slots */
				var rootRef = firebase.database().ref('COMPUTER SCIENCE AND ENGINEERING/timetable/' + year + '/' + semester +'/'+ "Monday" +'/');
						rootRef.on("child_added", snap =>{
							var subjectName = snap.child("subject_name").val();
							var time = snap.child("selectedSlot").val();

							if(time == "8 - 9"){
								document.getElementById('timetable').rows[4].cells[1].innerHTML = subjectName;
							}else if(time == "9 - 10"){
								document.getElementById('timetable').rows[4].cells[2].innerHTML = subjectName;
							}else if(time == "10 - 11"){
								document.getElementById('timetable').rows[4].cells[3].innerHTML = subjectName;
							}else if(time == "11 - 12"){
								document.getElementById('timetable').rows[4].cells[4].innerHTML = subjectName;
							}else if(time == "12 - 1"){
								document.getElementById('timetable').rows[4].cells[5].innerHTML = subjectName;
							}else if(time == "1 30 - 2 30"){
								document.getElementById('timetable').rows[4].cells[6].innerHTML = subjectName;
							}else if(time == "2 30 - 3 30"){
								document.getElementById('timetable').rows[4].cells[7].innerHTML = subjectName;
							}else if(time == "3 30 - 4 30"){
								document.getElementById('timetable').rows[4].cells[8].innerHTML = subjectName;
							}else{
							//	alert("time ran Out");
							}
						});

						/* Tuesday Slots */
						var rootRef = firebase.database().ref('COMPUTER SCIENCE AND ENGINEERING/timetable/'+ year + '/' + semester +'/'+ "Tuesday" +'/');
								rootRef.on("child_added", snap =>{
									var subjectName = snap.child("subject_name").val();
									var time = snap.child("selectedSlot").val();

									if(time == "8 - 9"){
										document.getElementById('timetable').rows[5].cells[1].innerHTML = subjectName;
									}else if(time == "9 - 10"){
										document.getElementById('timetable').rows[5].cells[2].innerHTML = subjectName;
									}else if(time == "10 - 11"){
										document.getElementById('timetable').rows[5].cells[3].innerHTML = subjectName;
									}else if(time == "11 - 12"){
										document.getElementById('timetable').rows[5].cells[4].innerHTML = subjectName;
									}else if(time == "12 - 1"){
										document.getElementById('timetable').rows[5].cells[5].innerHTML = subjectName;
									}else if(time == "1 30 - 2 30"){
										document.getElementById('timetable').rows[5].cells[6].innerHTML = subjectName;
									}else if(time == "2 30 - 3 30"){
										document.getElementById('timetable').rows[5].cells[7].innerHTML = subjectName;
									}else if(time == "3 30 - 4 30"){
										document.getElementById('timetable').rows[5].cells[8].innerHTML = subjectName;
									}else{
									//	alert("time ran Out");
									}
								});

								/* Wednesday Slots */
								var rootRef = firebase.database().ref('COMPUTER SCIENCE AND ENGINEERING/timetable/' + year + '/' + semester +'/'+ "Wednesday" +'/');
										rootRef.on("child_added", snap =>{
											var subjectName = snap.child("subject_name").val();
											var time = snap.child("selectedSlot").val();

											if(time == "8 - 9"){
												document.getElementById('timetable').rows[6].cells[1].innerHTML = subjectName;
											}else if(time == "9 - 10"){
												document.getElementById('timetable').rows[6].cells[2].innerHTML = subjectName;
											}else if(time == "10 - 11"){
												document.getElementById('timetable').rows[6].cells[3].innerHTML = subjectName;
											}else if(time == "11 - 12"){
												document.getElementById('timetable').rows[6].cells[4].innerHTML = subjectName;
											}else if(time == "12 - 1"){
												document.getElementById('timetable').rows[6].cells[5].innerHTML = subjectName;
											}else if(time == "1 30 - 2 30"){
												document.getElementById('timetable').rows[6].cells[6].innerHTML = subjectName;
											}else if(time == "2 30 - 3 30"){
												document.getElementById('timetable').rows[6].cells[7].innerHTML = subjectName;
											}else if(time == "3 30 - 4 30"){
												document.getElementById('timetable').rows[6].cells[8].innerHTML = subjectName;
											}else{
											//	alert("time ran Out");
											}
										});

										/* Thursday Slots */
										var rootRef = firebase.database().ref('COMPUTER SCIENCE AND ENGINEERING/timetable/' + year + '/' + semester +'/'+ "Thursday" +'/');
												rootRef.on("child_added", snap =>{
													var subjectName = snap.child("subject_name").val();
													var time = snap.child("selectedSlot").val();

													if(time == "8 - 9"){
														document.getElementById('timetable').rows[7].cells[1].innerHTML = subjectName;
													}else if(time == "9 - 10"){
														document.getElementById('timetable').rows[7].cells[2].innerHTML = subjectName;
													}else if(time == "10 - 11"){
														document.getElementById('timetable').rows[7].cells[3].innerHTML = subjectName;
													}else if(time == "11 - 12"){
														document.getElementById('timetable').rows[7].cells[4].innerHTML = subjectName;
													}else if(time == "12 - 1"){
														document.getElementById('timetable').rows[7].cells[5].innerHTML = subjectName;
													}else if(time == "1 30 - 2 30"){
														document.getElementById('timetable').rows[7].cells[6].innerHTML = subjectName;
													}else if(time == "2 30 - 3 30"){
														document.getElementById('timetable').rows[7].cells[7].innerHTML = subjectName;
													}else if(time == "3 30 - 4 30"){
														document.getElementById('timetable').rows[7].cells[8].innerHTML = subjectName;
													}else{
													//	alert("time ran Out");
													}
												});

												/* Friday Slots */
												var rootRef = firebase.database().ref('COMPUTER SCIENCE AND ENGINEERING/timetable/' + year + '/' + semester +'/'+ "Friday" +'/');
														rootRef.on("child_added", snap =>{
															var subjectName = snap.child("subject_name").val();
															var time = snap.child("selectedSlot").val();

															if(time == "8 - 9"){
																document.getElementById('timetable').rows[8].cells[1].innerHTML = subjectName;
															}else if(time == "9 - 10"){
																document.getElementById('timetable').rows[8].cells[2].innerHTML = subjectName;
															}else if(time == "10 - 11"){
																document.getElementById('timetable').rows[8].cells[3].innerHTML = subjectName;
															}else if(time == "11 - 12"){
																document.getElementById('timetable').rows[8].cells[4].innerHTML = subjectName;
															}else if(time == "12 - 1"){
																document.getElementById('timetable').rows[8].cells[5].innerHTML = subjectName;
															}else if(time == "1 30 - 2 30"){
																document.getElementById('timetable').rows[8].cells[6].innerHTML = subjectName;
															}else if(time == "2 30 - 3 30"){
																document.getElementById('timetable').rows[8].cells[7].innerHTML = subjectName;
															}else if(time == "3 30 - 4 30"){
																document.getElementById('timetable').rows[8].cells[8].innerHTML = subjectName;
															}else{
															//	alert("time ran Out");
															}
														});

														/* Saturday Slots */
														var rootRef = firebase.database().ref('COMPUTER SCIENCE AND ENGINEERING/timetable/' + year + '/' + semester +'/'+ "Saturday" +'/');
																rootRef.on("child_added", snap =>{
																	var subjectName = snap.child("subject_name").val();
																	var time = snap.child("selectedSlot").val();

																	if(time == "8 - 9"){
																		document.getElementById('timetable').rows[9].cells[1].innerHTML = subjectName;
																	}else if(time == "9 - 10"){
																		document.getElementById('timetable').rows[9].cells[2].innerHTML = subjectName;
																	}else if(time == "10 - 11"){
																		document.getElementById('timetable').rows[9].cells[3].innerHTML = subjectName;
																	}else if(time == "11 - 12"){
																		document.getElementById('timetable').rows[9].cells[4].innerHTML = subjectName;
																	}else if(time == "12 - 1"){
																		document.getElementById('timetable').rows[9].cells[5].innerHTML = subjectName;
																	}else if(time == "1 30 - 2 30"){
																		document.getElementById('timetable').rows[9].cells[6].innerHTML = subjectName;
																	}else if(time == "2 30 - 3 30"){
																		document.getElementById('timetable').rows[9].cells[7].innerHTML = subjectName;
																	}else if(time == "3 30 - 4 30"){
																		document.getElementById('timetable').rows[9].cells[8].innerHTML = subjectName;
																	}else{
																	//	alert("time ran Out");
																	}
																});

			}
		}

	}

	function load(){
		var table = document.getElementById('timetable');
		table.reload();
		alert("reloaded");
	}

	</script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  		<script src="table2excel.js" type="text/javascript"></script>

  	<script type="text/javascript">
  			function Export() {

  				$("#timetable").table2excel({
  								filename: "Timetable.xls"
  						});
  				/*
  					html2canvas(document.getElementById('timetable'), {
  							onrendered: function (canvas) {
  									var data = canvas.toDataURL();
  									var docDefinition = {
  											content: [{
  													image: data,
  													width: 500
  											}]
  									};
  									pdfMake.createPdf(docDefinition).download("Table.pdf");
  							}
  					});
  					*/
  			}
  	</script>


</head>

<body onload="initalTimetable();">

	<header>
		<div class="menu" w3-include-html="h1.html">
			<ul>
				<li><a class="active" href="createTimetable.html">Create Timetable</a></li>
				<li><a href="addSubject.html">Add Subjects</a></li>
				<li><a href="addFaculty.html">Add Faculty</a></li>
				<li><a href="Export.html">Export</a></li>
				<li><a href="index.html" onclick="logout();">Logout</a></li>
			</ul>
		</div>
	</header> <br><br>


<div class="create-timetable-container">
	<center>
	<div class="align">
	<center><h2>Export Timetable</h2></center>
	<hr>

	<label for="selectYear"><b>Select Year</b></label>
	<select id="year" name="year">
		<option value="2018" selected>2018</option>
		<option value="2019" selected>2019</option>

	</select>

	<label for="selectSem"><b>Select semester</b></label>
	<select id="semester" name="semester">
		<option value="SEMESTER 1" selected>SEMESTER 1</option>
		<option value="SEMESTER 2" >SEMESTER 2</option>
		<option value="SEMESTER 3" >SEMESTER 3</option>
		<option value="SEMESTER 4" >SEMESTER 4</option>
		<option value="SEMESTER 5" >SEMESTER 5</option>
		<option value="SEMESTER 6" >SEMESTER 6</option>
	</select>
		<input type="button" class="submit" name="load" value="Load" onclick="initalTimetable();"/>
		<input type="button" class="submit" name="Export" value="Export" onclick="Export();"/>

	</div>

</div>

	<div style="width:700px;">

		<div class="right">
			<table id="timetable">
				<tr>
					<th colspan="9"><h3><center>S J (GOVT) POLYTECHNIC, BANGALORE</center></h3></th>
				</tr>
				<tr>
					<th colspan="9"><h3><center><b>DEPARTMENT OF COMPUTER SCIENCE & ENGG.</b></center></h3></th>
				</tr>

				<tr>
					<th colspan="9"><center>TENTATIVE TIME TABLE</center></th>
				</tr>
				<tr>
					<td class="blank" id="0"></td>
					<td class="title" id="1">08:00</td>
					<td class="title" id="2">09:00</td>
					<td class="title" id="3">10:00</td>
					<td class="title" id="4">11:00 </td>
					<td class="title" id="5">12:00</td>
					<td class="title" id="6">01.30</td>
					<td class="title" id="7">02.30</td>
					<td class="title" id="8">03.30</td>


				<tr>
					<td class="time" id="monday">Monday</td>
					<td class="drop" id="mon1"></td>
					<td class="drop" id="mon2"></td>
					<td class="drop" id="mon3"></td>
					<td class="drop" id="mon4"></td>
					<td class="drop" id="mon5"></td>
					<td class="drop" id="mon6"></td>
					<td class="drop" id="mon7"></td>
					<td class="drop" id="mon8"></td>

				</tr>
				<tr>
					<td class="time" id="tuesday">Tuesday</td>
					<td class="drop" id="1"></td>
					<td class="drop" id="2"></td>
					<td class="drop" id="3"></td>
					<td class="drop" id="5"></td>
					<td class="drop" id="4"></td>
					<td class="drop" id="6"></td>
					<td class="drop" id="7"></td>
					<td class="drop" id="8"></td>
				</tr>
				<tr>
					<td class="time" id="Wednesday">Wednesday</td>
					<td class="drop" id="1"></td>
					<td class="drop" id="2"></td>
					<td class="drop" id="3"></td>
					<td class="drop" id="4"></td>
					<td class="drop" id="5"></td>
					<td class="drop" id="6"></td>
					<td class="drop" id="7"></td>
					<td class="drop" id="8"></td>

				</tr>
				<tr>
					<td class="time" id="thursday">Thursday</td>
					<td class="drop" id="1"></td>
					<td class="drop" id="2"></td>
					<td class="drop" id="3"></td>
					<td class="drop" id="4"></td>
					<td class="drop" id="5"></td>
					<td class="drop" id="6"></td>
					<td class="drop" id="7"></td>
					<td class="drop" id="8"></td>

				</tr>
				<tr>
					<td class="time" id="friday">Friday</td>
					<td class="drop" id="1"></td>
					<td class="drop" id="2"></td>
					<td class="drop" id="3"></td>
					<td class="drop" id="4"></td>
					<td class="drop" id="5"></td>
					<td class="drop" id="6"></td>
					<td class="drop" id="7"></td>
					<td class="drop" id="8"></td>

				</tr>
				<tr>
					<td class="time" id="saturday">Saturday</td>
					<td class="drop" id="1"></td>
					<td class="drop" id="2"></td>
					<td class="drop" id="3"></td>
					<td class="drop" id="4"></td>
					<td class="drop" id="5"></td>
					<td class="drop" id="6"></td>
					<td class="drop" id="7"></td>
					<td class="drop" id="8"></td>

				</tr>
			</table>
		</div

	</div>

	<style type="text/css">
		.left{
			width:100px;
			float:left;
		}
		.left table{
			background:#E0ECFF;
		}
		.left td{

			background:#eee;
		}
		.right{
			float:right;
			width:550px;
		}
		.right table{
			border : 2px solid black;
			background:#E0ECFF;
			width:70%;


		}
		.right td{
			width: 100%;
			padding: 15px;
			margin: 5px 0 22px 0;
			border: none;
			background: #f1f1f1;

		}
		.right td{
			background:#E0ECFF;

		}
		.right td.drop{
			background:#fafafa;
			width:100px;
		}
		.right td.over{
			background:#FBEC88;
		}
		.item{
			text-align:center;
			font-weight: bold;
			font-size: 15px;
			border:1px solid #499B33;
			background:#fafafa;
			color:#444;
			width:100px;
		}
		.assigned{
			border:1px solid #BC2A4D;
		}
		.trash{
			background-color:red;
		}

	</style>
	<script>
		$(function(){
			$('.left .item').draggable({
				revert:true,
				proxy:'clone'
			});
			$('.right td.drop').droppable({
				onDragEnter:function(){
					$(this).addClass('over');
				},
				onDragLeave:function(){
					$(this).removeClass('over');
				},
				onDrop:function(e,source){
					$(this).removeClass('over');
					if ($(source).hasClass('assigned')){
					  	$(this).append(source);
					} else {
						var c = $(source).clone().addClass('assigned');
						$(this).empty().append(c);
						c.draggable({
							revert:true
						});
					}
				}
			});
			$('.left').droppable({
				accept:'.assigned',
				onDragEnter:function(e,source){
					$(source).addClass('trash');
				},
				onDragLeave:function(e,source){
					$(source).removeClass('trash');
				},
				onDrop:function(e,source){
					$(source).remove();
				}
			});
		});
	</script>

</body>
</html>
